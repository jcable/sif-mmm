Booting diskless edge devices

= Introduction =

Configuration for dnsmasq and pxelinux, as well as thoughts for root mounts.

= Details =

== dnsmasq ==

I initially used my home router and configured dnsmasq on it as follows:

dhcp-boot=pxelinux.0,,192.168.2.136

Debian has dnsmask as a package and if you put it on the boot server this line becomes

dhcp-boot=pxelinux.0

== tftp ==

I tried to use the dnsmasq tftp server but it didn't work so I used tftpd-hpa.

On Debian unstable the tftpd-hpa package installs with defaults for the root directory in

/var/lib/tftpboot

The file /etc/default/tftpd-hpa needs to be edited to enable the server.

I put the following in /var/lib/tftpboot:

copy the contents of the tftpboot directory created by lh_build to /var/lib/tftpboot.

= root partitions =

Possibilities:

 * whole system in the initramfs
 * root mounted over iSCSI
 * root mounted over drbd

== Whole system in the initramfs ==

some experience on gentoo that one can make a normal file system as a cpio and use it as a n initramfs. Not got this to work yet.

== System in RAM ==

Got this to work really well using the Debian live-helper. Live-helper will make all the files needed for USB, CD or netboot live CDs. Netboot expects to mount the root file system over NFS but its possible to edit the pxelinux.cfg file and get the root file system fetched from a web server and copied. this gives us a completely stand alone cow (copy on write) system where copies don't survive reboots.

Here is the pxelinux stanza:

LABEL www
        MENU LABEL Start Debian Live using webserver
        kernel debian-live/i386/vmlinuz-2.6.26-1-486
        append initrd=debian-live/i386/initrd.img-2.6.26-1-486 boot=live locale=en_GB.UTF-8 keyb=uk union=aufs fetch=http://192.168.2.136/filesystem.squashfs

It should be possible to sync the cow bit to get persistance.